<div class="container">
  <p id="notice"><%= notice %></p>
  <p>
    <strong>Full name:</strong>
    <%= @author.full_name %>
  </p>
  <p>
    <strong>Last name:</strong>
    <%= @author.last_name %>
  </p>
  <p>
    <strong>Given name:</strong>
    <%= @author.given_name %>
  </p>
  <p>
    <strong>Orcid:</strong>
    <%= @author.orcid %>
  </p>
  <p>
    <strong>Articles (<%= @author.articles.active.count %>):</strong>
    <%
      art_list = ""
      for art in @author.articles.active.order(:title)
        art_list += ' ' + link_to(art.title, art)
      end
    %>
    <%= art_list.html_safe %>
  </p>
  <%
    expertise = []
    expertise_lnks = ""
    @author.articles.each do |art|
      art.article_themes.each do |art_theme|
        if not expertise.include?(art_theme.theme.short) then
          expertise.push(art_theme.theme.short)
          if expertise_lnks == "" then
            expertise_lnks = link_to(art_theme.theme.short, art_theme.theme)
          else
            expertise_lnks += ", ".html_safe + link_to(art_theme.theme.short, art_theme.theme)
          end
        end
      end
    end
  %>
  <p>
    <strong>Expertise:</strong> <%= expertise_lnks  %>
  </p>
  <%
    affiliation = []
    affiliation_lnks = ""
    @author.affiliations.each do |afi|
      if not affiliation.include?(afi) then
        affiliation.push(afi)
        if affiliation_lnks == "" then
          affiliation_lnks = link_to(afi.institution, afi)
        else
          affiliation_lnks += ", ".html_safe + link_to(afi.institution, afi)
        end
      end
    end
  %>
  <p>
    <strong>Affiliations:</strong> <%= affiliation_lnks  %>
  </p>
  <% if user_signed_in? %>
    <ul class="nav nav-tabs" id="publicationsTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="details-tab" data-toggle="tab" href="#article_details" role="tab" aria-controls="article_details" aria-selected="true">
          Article Links (<%= @author.article_authors.count %>)
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="authors-tab" data-toggle="tab" href="#authors" role="tab" aria-controls="authors" aria-selected="false">
          Affiliations (from article links)
        </a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane form-inline fade show active" id="article_details" role="tabpanel" aria-labelledby="article_details-tab">
        <%= render partial: 'article_authors/list', locals: {article_authors: @author.article_authors } %>
      </div>
      <div class="tab-pane fade" id="authors" role="tabpanel" aria-labelledby="authors-tab">
        SHOW affiliations here
      </div>
    </div>
  <% end %>
  <%= link_to 'Edit', edit_author_path(@author), :class => "btn btn-primary btn-sm" %> |
  <%= link_to 'Back', authors_path, :class => "btn btn-secondary btn-sm" %>
</div>
