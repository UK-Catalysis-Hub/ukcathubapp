<% @authors_list = Article.active.joins(:authors).select("authors.id, full_name, COUNT(*) AS 'article_count'").order("article_count DESC").group("authors.full_name").limit(5) %>
<div class="container">
  <main role="main">
    <div class="row my-1"><!-- Qucik info row -->
      <div class="col-sm-3 col-6">
        <div class="container"><!-- info box -->
          <div class="row bg-primary  rounded border-primary">
            <div class="col-sm-6">
        			<h1><%= Article.active.count() %></h1>
        			<h6>Publications</h6>
        		</div>
            <div class="col-sm-6 my-1">
        			<%= image_tag('books2.svg', height: '64', width: '64', class: "rounded float-right d-block") %>
        		</div>
            <%= link_to 'More Info', articles_path, :class => "btn btn-primary btn-sm btn-block text-dark" %>
        	</div>
        </div>
      </div>  <!-- info box -->
        <div class="col-sm-3 col-6">
          <div class="container"><!-- info box -->
            <div class="row bg-secondary  rounded border-secondary my-0">
              <div class="col-sm-6">
          			<h1><%= Author.count() %></h1>
          			<h6>Authors</h6>
          		</div>
              <div class="col-sm-6 my-1">
          			<%= image_tag('users.svg', height: '64', width: '64', class: "rounded float-right d-block") %>
          		</div>
              <%= link_to 'More Info', authors_path, :class => "btn btn-secondary btn-sm btn-block text-dark" %>
          	</div>
        </div> <!-- info box -->
      </div>
      <div class="col-sm-3 col-6">
        <div class="container"><!-- info box -->
          <div class="row bg-success  rounded border-success">
            <div class="col-sm-6">
        			<h1><%= Affiliation.count() %></h1>
        			<h6>Institutions</h6>
        		</div>
            <div class="col-sm-6 my-1">
        			<%= image_tag('institution.svg', height: '64', width: '64', class: "rounded float-right d-block") %>
        		</div>
            <%= link_to 'More Info', affiliations_path, :class => "btn btn-success btn-sm btn-block text-dark" %>
        	</div>
        </div> <!-- info box -->
      </div>
      <div class="col-sm-3 col-6">
        <div class="container"><!-- info box -->
          <div class="row bg-danger  rounded border-danger ">
            <div class="col-sm-6">
              <h1><%= Dataset.count() %></h1>
              <h6 class="card-title">Datasets</h6>
            </div>
            <div class="col-sm-6 my-1">
              <%= image_tag('database.svg', height: '64', width: '64', class: "rounded float-right d-block") %>
            </div>
            <%= link_to 'More Info', datasets_path, :class => "btn btn-danger btn-sm btn-block text-dark" %>
          </div>
        </div> <!-- info box -->
      </div>
    </div>
    <div class="row px-1 my-3">
      <div class="col-sm-6 col-lg-8">
        <div class="card">
          <div class="card-header bg-light">
            <h6 style= "margin:auto">Recent publications</h6>
          </div>
          <div class="card-body p-0" style= "margin:auto">
            <%= render partial: 'articles/articles_recent', locals: {articles: Article.latest.limit(5) }%>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Publications by theme</h6>
          </div>
          <div class="card-body p-0">
            <% # replace model with view
               # themes_list = Theme.joins(:articles).group(:short).order(:id).count()
               themes_list = ListTheme.all.collect{|th|
                                             [th.short, th.article_count]} %>
            <%= pie_chart themes_list,  legend: "right", donut: true, library: { pieSliceText: 'count' } %>
          </div>
        </div>
      </div>
    </div>

    <div class="row px-1 my-3">
      <div class="col-sm-6 col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Top publishing authors</h6>
          </div>
          <div class="card-body p-0">
            <%= render partial: 'authors/authors_top', locals: {authors: @authors_list }%>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-8">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Most cited publications</h6>
          </div>
          <div class="card-body p-0">
            <%= render partial: 'articles/articles_referenced', locals: {articles: Article.most_cited.limit(5) }%>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-sm-4">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Most cited authors</h6>
          </div>
          <div class="card-body p-0">
            <%= render partial: 'authors/authors_pub_top', locals: {authors: Author.top_published.limit(5) }%>
          </div>
        </div>
      </div><!--col-sm-4-->

  		<div class="col-sm-8 themed-grid-col">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Publications by year</h6>
          </div>
          <div class="card-body p-0">
            <% year_series = {}
               arts_by_year = Article.where(:status => "Added").group(:pub_year).count %>
            <%= column_chart arts_by_year %>
          </div>
        </div>
      </div>
  	</div> <!--row mb3 -->

    <div class="row mb-3">
      <div class="col-sm-6">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Publications accumulated per year</h6>
          </div>
          <div class="card-body p-0">
            <% year_series = {}
               arts_by_year = Article.where(:status => "Added").group(:pub_year).count
               year_series[0] = arts_by_year
               sum = 0
               year_series[1] = arts_by_year.each.collect{ |aby| [aby[0], sum+=aby[1]] } %>
            <%= column_chart(year_series[1], library: { :series => { 1 => { type: "line"} } } )%>
          </div>
        </div>
      </div><!--col-sm-6-->

      <div class="col-sm-6 themed-grid-col">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Publications line chart </h6>
          </div>
          <div class="card-body p-0">
            <% year_series = {}
               arts_by_year = Article.where(:status => "Added").group(:pub_year).count
               year_series[0] = arts_by_year
               sum = 0
               year_series[1] = arts_by_year.each.collect{ |aby| [aby[0], sum+=aby[1]] } %>
            <%= line_chart(year_series )%>
          </div>
        </div>
      </div><!--col-sm-6-->
    </div><!--row-->
    <div class="row mb-3">
      <div class="col-sm-6">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Timeline</h6>
          </div>
          <div class="card-body p-0">
            <%= timeline [
                  ["Washington", "1789-04-29", "1797-03-03"],
                  ["Adams", "1797-03-03", "1801-03-03"],
                  ["Jefferson", "1801-03-03", "1809-03-03"]
                  ] %>
          </div>
        </div>
      </div><!--col-sm-6-->

      <div class="col-sm-6 themed-grid-col">
        <div class="card">
          <div class="card-header">
            <h6 style= "margin:auto">Map Chart</h6>
          </div>
          <div class="card-body p-0">
            <%= geo_chart AuthorAffiliation.group(:country).count %>
          </div>
        </div>
      </div><!--col-sm-6-->
    </div><!--row-->
  </main>
</div>
